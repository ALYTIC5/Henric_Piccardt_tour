<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no" />
  <title>Henric Piccardt â€“ Voice Tour</title>
  <meta name="theme-color" content="#1d1d1b" />
  <style>
    /* Page base */
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: #000;
      overflow: hidden; /* unlocked after consent */
    }

    /* Single full-screen background image of Hendric */
    #bg {
      position: fixed;
      inset: 0;
      background: center center / cover no-repeat;
      z-index: 0;
    }

    /* Optional nameplate (keep or remove) */
    #nameplate {
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      max-width: 55%;
      height: auto;
      z-index: 3;
      pointer-events: none;
      opacity: 0;
      transition: opacity 1.2s ease-in;
    }
    #nameplate.visible { opacity: 1; }

    /* Widget container pinned near bottom-center */
    .widget-container {
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      width: min(92vw, 600px);
      z-index: 2;
    }
    .widget-container > elevenlabs-convai,
    .widget-container iframe {
      width: 100%;
      height: 150px;
    }

    /* ================= CONSENT OVERLAY (FULL WHITE SCREEN) ================= */
    #consentOverlay {
      position: fixed; inset: 0;
      background: #fff;
      display: flex; align-items: center; justify-content: center;
      z-index: 99999;
    }
    #consentBox {
      width: min(92vw, 520px);
      border: 2px solid #1D1D1B;
      border-radius: 16px;
      background: #fff;
      box-shadow: 0 12px 40px rgba(0,0,0,0.15);
      padding: 24px 22px;
      text-align: center;
      color: #1D1D1B;
    }
    #consentBox h2 { margin: 0 0 12px; font-size: 22px; line-height: 1.2; }
    #consentBox p  { margin: 0 0 18px; font-size: 15px; line-height: 1.45; opacity: 0.85; }
    .consentButtons {
      display: flex; gap: 12px; justify-content: center; align-items: center; margin-top: 6px;
    }
    .consentButtons button {
      flex: 1 1 auto; padding: 12px 16px;
      border-radius: 12px; border: 2px solid transparent; font-weight: 800; cursor: pointer;
    }
    #consentYes { background: #0b6efd; color: #fff; }
    #consentYes:hover { filter: brightness(0.95); }
    #consentNo  { background: #f2f2f2; color: #1D1D1B; border-color: #ddd; }
    #consentNo:hover  { background: #e9e9e9; }
  </style>
</head>
<body>
  <!-- Single image background (set below in JS) -->
  <div id="bg"></div>

  <!-- Optional nameplate; remove if not needed -->
  <img id="nameplate" src="name-removebg.png" alt="Henric Piccardt" />

  <!-- Consent gate -->
  <div id="consentOverlay" role="dialog" aria-modal="true" aria-labelledby="consentTitle">
    <div id="consentBox">
      <h2 id="consentTitle">Toestemming vereist</h2>
      <p>
        Deze tour gebruikt de ElevenLabs gesprek-widget (microfoon kan worden gevraagd) en achtergrondmuziek.<br>
        Ga je akkoord om verder te gaan?
      </p>
      <div class="consentButtons">
        <button id="consentYes" aria-label="Accepteren en doorgaan">Ja</button>
        <button id="consentNo"  aria-label="Weigeren en terug">Nee</button>
      </div>
    </div>
  </div>

  <!-- Widget goes here -->
  <div class="widget-container" id="widgetContainer"></div>

  <!-- Background music (loop) -->
  <audio id="bgAudio" src="Background Music.mp3" loop preload="auto" playsinline webkit-playsinline></audio>

  <script>
    /* ---------------- Configuration ---------------- */
    // Use your Hendric agent ID (from your existing Henric app).
    const HENDRIC_AGENT_ID = "agent_4401k3npmamcf5hawj56bagnz96v"; // :contentReference[oaicite:2]{index=2}
    // Point this to the single Hendric image you want to show after consent:
    const HERO_IMAGE = "hendric.jpg"; // <-- replace with your actual image file (e.g., "background_convo.png")

    // Volumes (match Wadden behavior): BG at 20%, AI at 100%
    const BG_VOLUME = 0.20;
    const AI_WIDGET_VOLUME_CSS = 1.0; // widget prop via CSS variable

    /* ---------------- DOM refs ---------------- */
    const consentOverlay = document.getElementById('consentOverlay');
    const consentYes = document.getElementById('consentYes');
    const consentNo  = document.getElementById('consentNo');
    const widgetContainer = document.getElementById('widgetContainer');
    const bgAudio = document.getElementById('bgAudio');
    const nameplate = document.getElementById('nameplate');
    const bg = document.getElementById('bg');

    /* ---------------- Audio graph (like Wadden) ---------------- */
    let audioCtx, bgGainNode;

    function initAudio() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        bgGainNode = audioCtx.createGain();
        bgGainNode.gain.value = BG_VOLUME; // constant 20%
        const src = audioCtx.createMediaElementSource(bgAudio);
        src.connect(bgGainNode).connect(audioCtx.destination);
      }
      if (audioCtx.state === 'suspended') {
        audioCtx.resume().catch(()=>{});
      }
    }

    function startBed() {
      bgAudio.play().catch(()=>{});
      // Make extra sure it stays playing (some browsers pause on route changes)
      setTimeout(() => { if (bgAudio.paused) bgAudio.play().catch(()=>{}); }, 400);
      setTimeout(() => { if (bgAudio.paused) bgAudio.play().catch(()=>{}); }, 1200);
    }

    /* ---------------- Widget ---------------- */
    function mountWidget() {
      // Load ElevenLabs widget script (Wadden approach) :contentReference[oaicite:3]{index=3}
      if (!document.querySelector('script[src*="@elevenlabs/convai-widget-embed"]')) {
        const s = document.createElement('script');
        s.src = 'https://unpkg.com/@elevenlabs/convai-widget-embed';
        s.async = true;
        document.head.appendChild(s);
      }
      // Inject widget with Hendric agent & voice volume locked at 100%
      widgetContainer.innerHTML =
        `<elevenlabs-convai agent-id="${HENDRIC_AGENT_ID}" style="--voice-volume:${AI_WIDGET_VOLUME_CSS};"></elevenlabs-convai>`;
    }

    /* ---------------- Consent flow ---------------- */
    function grantConsent() {
      consentOverlay.style.display = 'none';
      document.documentElement.style.overflow = 'auto';
      document.body.style.overflow = 'auto';

      // Set the single Hendric image
      bg.style.backgroundImage = `url('${HERO_IMAGE}')`;

      // Optional: show nameplate after a short moment
      setTimeout(() => { nameplate.classList.add('visible'); }, 2000);

      // Prepare audio and start bed @ 20%
      initAudio();
      startBed();

      // Ask for mic once (user just interacted)
      navigator.mediaDevices.getUserMedia({ audio: true }).catch(()=>{ /* if denied, widget still loads */ });

      // Mount the ElevenLabs widget (AI remains at 100%)
      mountWidget();
    }

    function declineConsent() {
      if (window.history.length > 1) {
        window.history.back();
      } else {
        // neutral fallback
        window.location.replace('https://sense-of-place.eu/');
      }
    }

    consentYes.addEventListener('click', grantConsent);
    consentNo.addEventListener('click', declineConsent);

    /* ---------------- Preload single image for snappy swap ---------------- */
    (new Image()).src = HERO_IMAGE;
  </script>
</body>
</html>
